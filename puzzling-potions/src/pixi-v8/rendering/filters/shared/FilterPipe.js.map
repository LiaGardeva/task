{"version":3,"file":"FilterPipe.js","sources":["../../../../src/rendering/filters/shared/FilterPipe.ts"],"sourcesContent":["import { ExtensionType } from '../../../extensions/Extensions';\nimport { UniformGroup } from '../../renderers/shared/shader/UniformGroup';\n\nimport type { InstructionSet } from '../../renderers/shared/instructions/InstructionSet';\nimport type { InstructionPipe } from '../../renderers/shared/instructions/RenderPipe';\nimport type { Renderer } from '../../renderers/types';\nimport type { Container } from '../../scene/Container';\nimport type { FilterEffect } from '../FilterEffect';\nimport type { FilterInstruction } from './FilterSystem';\n\n// eslint-disable-next-line max-len\nexport class FilterPipe implements InstructionPipe<FilterInstruction>\n{\n    static extension = {\n        type: [\n            ExtensionType.WebGLPipes,\n            ExtensionType.WebGPUPipes,\n            ExtensionType.CanvasPipes,\n        ],\n        name: 'filter',\n    } as const;\n\n    renderer: Renderer;\n\n    filterGlobalUniforms = new UniformGroup({\n        inputSize: { value: new Float32Array(4), type: 'vec4<f32>' },\n        inputPixel: { value: new Float32Array(4), type: 'vec4<f32>' },\n        inputClamp: { value: new Float32Array(4), type: 'vec4<f32>' },\n        outputFrame: { value: new Float32Array(4), type: 'vec4<f32>' },\n        backgroundFrame: { value: new Float32Array(4), type: 'vec4<f32>' },\n        globalFrame: { value: new Float32Array(4), type: 'vec4<f32>' },\n    });\n\n    constructor(renderer: Renderer)\n    {\n        this.renderer = renderer;\n    }\n\n    push(filterEffect: FilterEffect, container: Container, instructionSet: InstructionSet): void\n    {\n        const renderPipes = this.renderer.renderPipes;\n\n        renderPipes.batch.break(instructionSet);\n\n        instructionSet.add({\n            type: 'filter',\n            canBundle: false,\n            action: 'pushFilter',\n            container,\n            filterEffect,\n        } as FilterInstruction);\n    }\n\n    pop(_filterEffect: FilterEffect, _container: Container, instructionSet: InstructionSet): void\n    {\n        this.renderer.renderPipes.batch.break(instructionSet);\n\n        instructionSet.add({\n            type: 'filter',\n            action: 'popFilter',\n            canBundle: false,\n        });\n    }\n\n    execute(instruction: FilterInstruction)\n    {\n        if (instruction.action === 'pushFilter')\n        {\n            this.renderer.filter.push(instruction);\n        }\n        else if (instruction.action === 'popFilter')\n        {\n            this.renderer.filter.pop();\n        }\n    }\n\n    destroy(): void\n    {\n        this.renderer = null;\n        this.filterGlobalUniforms = null;\n    }\n}\n"],"names":["UniformGroup","ExtensionType"],"mappings":";;;;;;;AAWO,MAAM,UACb,CAAA;AAAA,EAqBI,YAAY,QACZ,EAAA;AAVA,IAAA,IAAA,CAAA,oBAAA,GAAuB,IAAIA,yBAAa,CAAA;AAAA,MACpC,SAAA,EAAW,EAAE,KAAO,EAAA,IAAI,aAAa,CAAC,CAAA,EAAG,MAAM,WAAY,EAAA;AAAA,MAC3D,UAAA,EAAY,EAAE,KAAO,EAAA,IAAI,aAAa,CAAC,CAAA,EAAG,MAAM,WAAY,EAAA;AAAA,MAC5D,UAAA,EAAY,EAAE,KAAO,EAAA,IAAI,aAAa,CAAC,CAAA,EAAG,MAAM,WAAY,EAAA;AAAA,MAC5D,WAAA,EAAa,EAAE,KAAO,EAAA,IAAI,aAAa,CAAC,CAAA,EAAG,MAAM,WAAY,EAAA;AAAA,MAC7D,eAAA,EAAiB,EAAE,KAAO,EAAA,IAAI,aAAa,CAAC,CAAA,EAAG,MAAM,WAAY,EAAA;AAAA,MACjE,WAAA,EAAa,EAAE,KAAO,EAAA,IAAI,aAAa,CAAC,CAAA,EAAG,MAAM,WAAY,EAAA;AAAA,KAChE,CAAA,CAAA;AAIG,IAAA,IAAA,CAAK,QAAW,GAAA,QAAA,CAAA;AAAA,GACpB;AAAA,EAEA,IAAA,CAAK,YAA4B,EAAA,SAAA,EAAsB,cACvD,EAAA;AACI,IAAM,MAAA,WAAA,GAAc,KAAK,QAAS,CAAA,WAAA,CAAA;AAElC,IAAY,WAAA,CAAA,KAAA,CAAM,MAAM,cAAc,CAAA,CAAA;AAEtC,IAAA,cAAA,CAAe,GAAI,CAAA;AAAA,MACf,IAAM,EAAA,QAAA;AAAA,MACN,SAAW,EAAA,KAAA;AAAA,MACX,MAAQ,EAAA,YAAA;AAAA,MACR,SAAA;AAAA,MACA,YAAA;AAAA,KACkB,CAAA,CAAA;AAAA,GAC1B;AAAA,EAEA,GAAA,CAAI,aAA6B,EAAA,UAAA,EAAuB,cACxD,EAAA;AACI,IAAA,IAAA,CAAK,QAAS,CAAA,WAAA,CAAY,KAAM,CAAA,KAAA,CAAM,cAAc,CAAA,CAAA;AAEpD,IAAA,cAAA,CAAe,GAAI,CAAA;AAAA,MACf,IAAM,EAAA,QAAA;AAAA,MACN,MAAQ,EAAA,WAAA;AAAA,MACR,SAAW,EAAA,KAAA;AAAA,KACd,CAAA,CAAA;AAAA,GACL;AAAA,EAEA,QAAQ,WACR,EAAA;AACI,IAAI,IAAA,WAAA,CAAY,WAAW,YAC3B,EAAA;AACI,MAAK,IAAA,CAAA,QAAA,CAAS,MAAO,CAAA,IAAA,CAAK,WAAW,CAAA,CAAA;AAAA,KACzC,MAAA,IACS,WAAY,CAAA,MAAA,KAAW,WAChC,EAAA;AACI,MAAK,IAAA,CAAA,QAAA,CAAS,OAAO,GAAI,EAAA,CAAA;AAAA,KAC7B;AAAA,GACJ;AAAA,EAEA,OACA,GAAA;AACI,IAAA,IAAA,CAAK,QAAW,GAAA,IAAA,CAAA;AAChB,IAAA,IAAA,CAAK,oBAAuB,GAAA,IAAA,CAAA;AAAA,GAChC;AACJ,CAAA;AAtEa,UAAA,CAEF,SAAY,GAAA;AAAA,EACf,IAAM,EAAA;AAAA,IACFC,wBAAc,CAAA,UAAA;AAAA,IACdA,wBAAc,CAAA,WAAA;AAAA,IACdA,wBAAc,CAAA,WAAA;AAAA,GAClB;AAAA,EACA,IAAM,EAAA,QAAA;AACV,CAAA;;;;"}