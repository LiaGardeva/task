{"version":3,"file":"ensurePrecision.mjs","sources":["../../../../../../src/rendering/renderers/gl/shader/program/ensurePrecision.ts"],"sourcesContent":["import type { PRECISION } from '../const';\n\n/**\n * Sets the float precision on the shader, ensuring the device supports the request precision.\n * If the precision is already present, it just ensures that the device is able to handle it.\n * @param src\n * @param root0\n * @param root0.requestedPrecision\n * @param root0.maxSupportedPrecision\n */\nexport function ensurePrecision(\n    src: string,\n    { requestedPrecision, maxSupportedPrecision }: {requestedPrecision: PRECISION, maxSupportedPrecision: PRECISION}\n): string\n{\n    if (src.substring(0, 9) !== 'precision')\n    {\n        // no precision supplied, so PixiJS will add the requested level.\n        let precision = requestedPrecision;\n\n        // If highp is requested but not supported, downgrade precision to a level all devices support.\n        if (requestedPrecision === 'highp' && maxSupportedPrecision !== 'highp')\n        {\n            precision = 'mediump';\n        }\n\n        if (src.substring(0, 8) !== '#version')\n        {\n            return `precision ${precision} float;\\n${src}`;\n        }\n\n        // get the first line break in the src\n        const firstLineBreak = src.indexOf('\\n');\n\n        // insert the precision statement after the first line\n        return `${src.substring(0, firstLineBreak + 1)}precision ${precision} float;\\n${src.substring(firstLineBreak + 1)}`;\n    }\n    else if (maxSupportedPrecision !== 'highp' && src.substring(0, 15) === 'precision highp')\n    {\n        // precision was supplied, but at a level this device does not support, so downgrading to mediump.\n        return src.replace('precision highp', 'precision mediump');\n    }\n\n    return src;\n}\n"],"names":[],"mappings":"AAUO,SAAS,eACZ,CAAA,GAAA,EACA,EAAE,kBAAA,EAAoB,uBAE1B,EAAA;AACI,EAAA,IAAI,GAAI,CAAA,SAAA,CAAU,CAAG,EAAA,CAAC,MAAM,WAC5B,EAAA;AAEI,IAAA,IAAI,SAAY,GAAA,kBAAA,CAAA;AAGhB,IAAI,IAAA,kBAAA,KAAuB,OAAW,IAAA,qBAAA,KAA0B,OAChE,EAAA;AACI,MAAY,SAAA,GAAA,SAAA,CAAA;AAAA,KAChB;AAEA,IAAA,IAAI,GAAI,CAAA,SAAA,CAAU,CAAG,EAAA,CAAC,MAAM,UAC5B,EAAA;AACI,MAAA,OAAO,CAAa,UAAA,EAAA,SAAA,CAAA;AAAA,EAAqB,GAAA,CAAA,CAAA,CAAA;AAAA,KAC7C;AAGA,IAAM,MAAA,cAAA,GAAiB,GAAI,CAAA,OAAA,CAAQ,IAAI,CAAA,CAAA;AAGvC,IAAA,OAAO,GAAG,GAAI,CAAA,SAAA,CAAU,CAAG,EAAA,cAAA,GAAiB,CAAC,CAAc,CAAA,UAAA,EAAA,SAAA,CAAA;AAAA,EAAqB,GAAA,CAAI,SAAU,CAAA,cAAA,GAAiB,CAAC,CAAA,CAAA,CAAA,CAAA;AAAA,GACpH,MAAA,IACS,0BAA0B,OAAW,IAAA,GAAA,CAAI,UAAU,CAAG,EAAA,EAAE,MAAM,iBACvE,EAAA;AAEI,IAAO,OAAA,GAAA,CAAI,OAAQ,CAAA,iBAAA,EAAmB,mBAAmB,CAAA,CAAA;AAAA,GAC7D;AAEA,EAAO,OAAA,GAAA,CAAA;AACX;;;;"}