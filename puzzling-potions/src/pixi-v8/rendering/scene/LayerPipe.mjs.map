{"version":3,"file":"LayerPipe.mjs","sources":["../../../src/rendering/scene/LayerPipe.ts"],"sourcesContent":["import { ExtensionType } from '../../extensions/Extensions';\nimport { executeInstructions } from './utils/executeInstructions';\n\nimport type { InstructionSet } from '../renderers/shared/instructions/InstructionSet';\nimport type { InstructionPipe } from '../renderers/shared/instructions/RenderPipe';\nimport type { Renderer } from '../renderers/types';\nimport type { LayerGroup } from './LayerGroup';\n\nexport class LayerPipe implements InstructionPipe<LayerGroup>\n{\n    static extension = {\n        type: [\n            ExtensionType.WebGLPipes,\n            ExtensionType.WebGPUPipes,\n            ExtensionType.CanvasPipes,\n        ],\n        name: 'layer',\n    } as const;\n\n    private renderer: Renderer;\n\n    constructor(renderer: Renderer)\n    {\n        this.renderer = renderer;\n    }\n\n    addLayerGroup(layerGroup: LayerGroup, instructionSet: InstructionSet): void\n    {\n        this.renderer.renderPipes.batch.break(instructionSet);\n\n        instructionSet.add(layerGroup);\n    }\n\n    execute(layerGroup: LayerGroup)\n    {\n        if (!layerGroup.isRenderable) return;\n\n        this.renderer.globalUniforms.push({\n            projectionMatrix: this.renderer.renderTarget.renderTarget.projectionMatrix,\n            worldTransformMatrix: layerGroup.worldTransform,\n            worldColor: layerGroup.worldColor,\n\n        });\n\n        executeInstructions(layerGroup, this.renderer.renderPipes);\n\n        this.renderer.globalUniforms.pop();\n\n        // now render a quad..\n    }\n\n    destroy(): void\n    {\n        this.renderer = null;\n    }\n}\n"],"names":[],"mappings":";;;AAQO,MAAM,SACb,CAAA;AAAA,EAYI,YAAY,QACZ,EAAA;AACI,IAAA,IAAA,CAAK,QAAW,GAAA,QAAA,CAAA;AAAA,GACpB;AAAA,EAEA,aAAA,CAAc,YAAwB,cACtC,EAAA;AACI,IAAA,IAAA,CAAK,QAAS,CAAA,WAAA,CAAY,KAAM,CAAA,KAAA,CAAM,cAAc,CAAA,CAAA;AAEpD,IAAA,cAAA,CAAe,IAAI,UAAU,CAAA,CAAA;AAAA,GACjC;AAAA,EAEA,QAAQ,UACR,EAAA;AACI,IAAA,IAAI,CAAC,UAAW,CAAA,YAAA;AAAc,MAAA,OAAA;AAE9B,IAAK,IAAA,CAAA,QAAA,CAAS,eAAe,IAAK,CAAA;AAAA,MAC9B,gBAAkB,EAAA,IAAA,CAAK,QAAS,CAAA,YAAA,CAAa,YAAa,CAAA,gBAAA;AAAA,MAC1D,sBAAsB,UAAW,CAAA,cAAA;AAAA,MACjC,YAAY,UAAW,CAAA,UAAA;AAAA,KAE1B,CAAA,CAAA;AAED,IAAoB,mBAAA,CAAA,UAAA,EAAY,IAAK,CAAA,QAAA,CAAS,WAAW,CAAA,CAAA;AAEzD,IAAK,IAAA,CAAA,QAAA,CAAS,eAAe,GAAI,EAAA,CAAA;AAAA,GAGrC;AAAA,EAEA,OACA,GAAA;AACI,IAAA,IAAA,CAAK,QAAW,GAAA,IAAA,CAAA;AAAA,GACpB;AACJ,CAAA;AA/Ca,SAAA,CAEF,SAAY,GAAA;AAAA,EACf,IAAM,EAAA;AAAA,IACF,aAAc,CAAA,UAAA;AAAA,IACd,aAAc,CAAA,WAAA;AAAA,IACd,aAAc,CAAA,WAAA;AAAA,GAClB;AAAA,EACA,IAAM,EAAA,OAAA;AACV,CAAA;;;;"}