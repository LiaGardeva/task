{"version":3,"file":"getLocalBounds.mjs","sources":["../../../../src/rendering/scene/bounds/getLocalBounds.ts"],"sourcesContent":["import { Matrix } from '../../../maths/Matrix';\nimport { updateLocalTransform } from '../utils/updateLocalTransform';\n\nimport type { Container } from '../Container';\nimport type { Bounds } from './Bounds';\n\nexport function getLocalBounds(target: Container, bounds: Bounds, relativeMatrix?: Matrix): Bounds\n{\n    bounds.clear();\n\n    // if (!target.visible)// || !target.measurable)\n    // {\n    //     bounds.set(0, 0, 0, 0);\n\n    //     return bounds;\n    // }\n\n    relativeMatrix ||= new Matrix();\n\n    if (target.view)\n    {\n        bounds.setMatrix(relativeMatrix);\n        target.view.addBounds(bounds);\n    }\n\n    for (let i = 0; i < target.children.length; i++)\n    {\n        _getLocalBounds(target.children[i], bounds, relativeMatrix, target);\n    }\n\n    if (!bounds.isValid)\n    {\n        bounds.set(0, 0, 0, 0);\n    }\n\n    return bounds;\n}\n\nfunction _getLocalBounds(target: Container, bounds: Bounds, parentTransform: Matrix, rootContainer: Container): void\n{\n    if (!target.visible || !target.measurable) return;\n\n    // // make sure localTransform is upto date...\n    if (target.didChange)\n    {\n        updateLocalTransform(target.localTransform, target);\n    }\n\n    const localTransform = target.localTransform;\n\n    const relativeTransform = Matrix.shared.appendFrom(localTransform, parentTransform).clone();\n\n    if (target.view)\n    {\n        bounds.setMatrix(relativeTransform);\n\n        target.view.addBounds(bounds);\n    }\n\n    for (let i = 0; i < target.children.length; i++)\n    {\n        _getLocalBounds(target.children[i], bounds, relativeTransform, rootContainer);\n    }\n\n    for (let i = 0; i < target.effects.length; i++)\n    {\n        target.effects[i].addLocalBounds?.(bounds, rootContainer);\n    }\n}\n\nexport function getParent(target: Container, root: Container, matrix: Matrix)\n{\n    const parent = target.parent;\n\n    if (!parent)\n    {\n        // we have reach the top of the tree!\n        console.warn('Item is not inside the root container');\n\n        return;\n    }\n\n    if (parent !== root)\n    {\n        getParent(parent, root, matrix);\n\n        updateLocalTransform(parent.localTransform, parent);\n        matrix.append(parent.localTransform);\n    }\n}\n\n"],"names":[],"mappings":";;;AAMgB,SAAA,cAAA,CAAe,MAAmB,EAAA,MAAA,EAAgB,cAClE,EAAA;AACI,EAAA,MAAA,CAAO,KAAM,EAAA,CAAA;AASb,EAAA,cAAA,KAAA,cAAA,GAAmB,IAAI,MAAO,EAAA,CAAA,CAAA;AAE9B,EAAA,IAAI,OAAO,IACX,EAAA;AACI,IAAA,MAAA,CAAO,UAAU,cAAc,CAAA,CAAA;AAC/B,IAAO,MAAA,CAAA,IAAA,CAAK,UAAU,MAAM,CAAA,CAAA;AAAA,GAChC;AAEA,EAAA,KAAA,IAAS,IAAI,CAAG,EAAA,CAAA,GAAI,MAAO,CAAA,QAAA,CAAS,QAAQ,CAC5C,EAAA,EAAA;AACI,IAAA,eAAA,CAAgB,OAAO,QAAS,CAAA,CAAC,CAAG,EAAA,MAAA,EAAQ,gBAAgB,MAAM,CAAA,CAAA;AAAA,GACtE;AAEA,EAAI,IAAA,CAAC,OAAO,OACZ,EAAA;AACI,IAAA,MAAA,CAAO,GAAI,CAAA,CAAA,EAAG,CAAG,EAAA,CAAA,EAAG,CAAC,CAAA,CAAA;AAAA,GACzB;AAEA,EAAO,OAAA,MAAA,CAAA;AACX,CAAA;AAEA,SAAS,eAAgB,CAAA,MAAA,EAAmB,MAAgB,EAAA,eAAA,EAAyB,aACrF,EAAA;AACI,EAAA,IAAI,CAAC,MAAA,CAAO,OAAW,IAAA,CAAC,MAAO,CAAA,UAAA;AAAY,IAAA,OAAA;AAG3C,EAAA,IAAI,OAAO,SACX,EAAA;AACI,IAAqB,oBAAA,CAAA,MAAA,CAAO,gBAAgB,MAAM,CAAA,CAAA;AAAA,GACtD;AAEA,EAAA,MAAM,iBAAiB,MAAO,CAAA,cAAA,CAAA;AAE9B,EAAA,MAAM,oBAAoB,MAAO,CAAA,MAAA,CAAO,WAAW,cAAgB,EAAA,eAAe,EAAE,KAAM,EAAA,CAAA;AAE1F,EAAA,IAAI,OAAO,IACX,EAAA;AACI,IAAA,MAAA,CAAO,UAAU,iBAAiB,CAAA,CAAA;AAElC,IAAO,MAAA,CAAA,IAAA,CAAK,UAAU,MAAM,CAAA,CAAA;AAAA,GAChC;AAEA,EAAA,KAAA,IAAS,IAAI,CAAG,EAAA,CAAA,GAAI,MAAO,CAAA,QAAA,CAAS,QAAQ,CAC5C,EAAA,EAAA;AACI,IAAA,eAAA,CAAgB,OAAO,QAAS,CAAA,CAAC,CAAG,EAAA,MAAA,EAAQ,mBAAmB,aAAa,CAAA,CAAA;AAAA,GAChF;AAEA,EAAA,KAAA,IAAS,IAAI,CAAG,EAAA,CAAA,GAAI,MAAO,CAAA,OAAA,CAAQ,QAAQ,CAC3C,EAAA,EAAA;AACI,IAAA,MAAA,CAAO,OAAQ,CAAA,CAAC,CAAE,CAAA,cAAA,GAAiB,QAAQ,aAAa,CAAA,CAAA;AAAA,GAC5D;AACJ,CAAA;AAEgB,SAAA,SAAA,CAAU,MAAmB,EAAA,IAAA,EAAiB,MAC9D,EAAA;AACI,EAAA,MAAM,SAAS,MAAO,CAAA,MAAA,CAAA;AAEtB,EAAA,IAAI,CAAC,MACL,EAAA;AAEI,IAAA,OAAA,CAAQ,KAAK,uCAAuC,CAAA,CAAA;AAEpD,IAAA,OAAA;AAAA,GACJ;AAEA,EAAA,IAAI,WAAW,IACf,EAAA;AACI,IAAU,SAAA,CAAA,MAAA,EAAQ,MAAM,MAAM,CAAA,CAAA;AAE9B,IAAqB,oBAAA,CAAA,MAAA,CAAO,gBAAgB,MAAM,CAAA,CAAA;AAClD,IAAO,MAAA,CAAA,MAAA,CAAO,OAAO,cAAc,CAAA,CAAA;AAAA,GACvC;AACJ;;;;"}